<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: drivers/mouse.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_14bc92f4b96c8519b376567118ac28b3.html">drivers</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">mouse.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file contains the necessary functions to process interrupts, parse mouse packets and sending of commands to the KBC.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;lcom/lcf.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;<a class="el" href="i8042_8h_source.html">i8042.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mouse.h:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8h__incl.png" border="0" usemap="#adrivers_2mouse_8h" alt=""/></div>
<map name="adrivers_2mouse_8h" id="adrivers_2mouse_8h">
<area shape="rect" title="This file contains the necessary functions to process interrupts, parse mouse packets and sending of ..." alt="" coords="5,5,132,31"/>
<area shape="rect" title=" " alt="" coords="37,152,122,177"/>
<area shape="poly" title=" " alt="" coords="56,33,29,64,21,84,23,103,36,124,54,142,50,145,32,127,18,105,16,83,24,62,52,29"/>
<area shape="rect" title=" " alt="" coords="33,79,104,104"/>
<area shape="poly" title=" " alt="" coords="71,31,71,65,66,65,66,31"/>
<area shape="rect" href="i8042_8h.html" title=" " alt="" coords="128,79,199,104"/>
<area shape="poly" title=" " alt="" coords="85,29,138,68,135,72,82,33"/>
<area shape="poly" title=" " alt="" coords="152,106,105,145,102,141,148,102"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8h__dep__incl.png" border="0" usemap="#adrivers_2mouse_8hdep" alt=""/></div>
<map name="adrivers_2mouse_8hdep" id="adrivers_2mouse_8hdep">
<area shape="rect" title="This file contains the necessary functions to process interrupts, parse mouse packets and sending of ..." alt="" coords="65,5,192,31"/>
<area shape="rect" href="mouse_8c.html" title=" " alt="" coords="5,79,132,104"/>
<area shape="poly" title=" " alt="" coords="112,43,80,80,76,77,108,40"/>
<area shape="rect" href="main_8c.html" title=" " alt="" coords="157,79,223,104"/>
<area shape="poly" title=" " alt="" coords="150,40,182,77,178,80,146,43"/>
</map>
</div>
</div>
<p><a href="mouse_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a20285aed4b3ef45812cd967532dd09db" id="r_a20285aed4b3ef45812cd967532dd09db"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#a20285aed4b3ef45812cd967532dd09db">mouse_subscribe_int</a> (uint8_t *bit_no)</td></tr>
<tr class="memdesc:a20285aed4b3ef45812cd967532dd09db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes mouse interrupts using irq_reenable and irq_exclusive policy.  <br /></td></tr>
<tr class="separator:a20285aed4b3ef45812cd967532dd09db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ecf823d80520009ae5e0d76ae40a3c3" id="r_a3ecf823d80520009ae5e0d76ae40a3c3"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#a3ecf823d80520009ae5e0d76ae40a3c3">mouse_unsubscribe_int</a> ()</td></tr>
<tr class="memdesc:a3ecf823d80520009ae5e0d76ae40a3c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubcribes mouse interrupts.  <br /></td></tr>
<tr class="separator:a3ecf823d80520009ae5e0d76ae40a3c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a210374b50462acdedab00df64d5cea3c" id="r_a210374b50462acdedab00df64d5cea3c"><td class="memItemLeft" align="right" valign="top">void()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#a210374b50462acdedab00df64d5cea3c">mouse_ih</a> ()</td></tr>
<tr class="memdesc:a210374b50462acdedab00df64d5cea3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads status register when an interrupt occurs and checks for timeout and parity errors, if none are found, it calls a function to read a byte to be placed in the mouse packet struct.  <br /></td></tr>
<tr class="separator:a210374b50462acdedab00df64d5cea3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab814784256e934abee308b68ac413719" id="r_ab814784256e934abee308b68ac413719"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#ab814784256e934abee308b68ac413719">kbc_restore_mouse</a> ()</td></tr>
<tr class="memdesc:ab814784256e934abee308b68ac413719"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disables data reporting from the mouse.  <br /></td></tr>
<tr class="separator:ab814784256e934abee308b68ac413719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bf906cc319e1b099f92b7c622f494fb" id="r_a1bf906cc319e1b099f92b7c622f494fb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#a1bf906cc319e1b099f92b7c622f494fb">issue_cmd_to_mouse</a> (uint8_t cmd)</td></tr>
<tr class="memdesc:a1bf906cc319e1b099f92b7c622f494fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">First the 0xD4 command is issued to the status port of the kbc, then command cmd is sent to the kbc output buffer, then 10 attempts are made to read the KBC's output buffer to check if the command was acknowledged(ACK)  <br /></td></tr>
<tr class="separator:a1bf906cc319e1b099f92b7c622f494fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addafa059c296f73e62410c2c60e11aa4" id="r_addafa059c296f73e62410c2c60e11aa4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#addafa059c296f73e62410c2c60e11aa4">read_data_from_KBC_mouse</a> (uint8_t *data)</td></tr>
<tr class="memdesc:addafa059c296f73e62410c2c60e11aa4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the KBC's status byte to check if KBC'S output buffer is full, if so, its contents are placed in 'data' parameter and checked for errors and correspondance to mouse data.  <br /></td></tr>
<tr class="separator:addafa059c296f73e62410c2c60e11aa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7740bd988610d35f2a3c2c1c0c7fb798" id="r_a7740bd988610d35f2a3c2c1c0c7fb798"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#a7740bd988610d35f2a3c2c1c0c7fb798">read_byte_to_mouse_packet</a> ()</td></tr>
<tr class="memdesc:a7740bd988610d35f2a3c2c1c0c7fb798"><td class="mdescLeft">&#160;</td><td class="mdescRight">Upon an interrupt this function is called, it reads a byte from the KBC and then places it in the mouse packet struct.  <br /></td></tr>
<tr class="separator:a7740bd988610d35f2a3c2c1c0c7fb798"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afee51d28c7388082c76862f11f44fedc" id="r_afee51d28c7388082c76862f11f44fedc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#afee51d28c7388082c76862f11f44fedc">array_to_packet</a> ()</td></tr>
<tr class="memdesc:afee51d28c7388082c76862f11f44fedc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buids the mouse packet.  <br /></td></tr>
<tr class="separator:afee51d28c7388082c76862f11f44fedc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfa7d6c9b92a1a2a14cb567591204033" id="r_adfa7d6c9b92a1a2a14cb567591204033"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8h.html#adfa7d6c9b92a1a2a14cb567591204033">issue_cmd_to_KBC</a> (uint8_t port, uint8_t cmd)</td></tr>
<tr class="memdesc:adfa7d6c9b92a1a2a14cb567591204033"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the KBC status bit and checks if output buffer is empty, if so this function issues a command 'cmd' to port 'port'.  <br /></td></tr>
<tr class="separator:adfa7d6c9b92a1a2a14cb567591204033"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the necessary functions to process interrupts, parse mouse packets and sending of commands to the KBC. </p>
<dl class="section date"><dt>Date</dt><dd>2024-06-02 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="afee51d28c7388082c76862f11f44fedc" name="afee51d28c7388082c76862f11f44fedc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afee51d28c7388082c76862f11f44fedc">&#9670;&#160;</a></span>array_to_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void array_to_packet </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Buids the mouse packet. </p>

</div>
</div>
<a id="adfa7d6c9b92a1a2a14cb567591204033" name="adfa7d6c9b92a1a2a14cb567591204033"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfa7d6c9b92a1a2a14cb567591204033">&#9670;&#160;</a></span>issue_cmd_to_KBC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int issue_cmd_to_KBC </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the KBC status bit and checks if output buffer is empty, if so this function issues a command 'cmd' to port 'port'. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>port taht will receive the command </td></tr>
    <tr><td class="paramname">cmd</td><td>command to be sent </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success, 1 otherwise </dd></dl>

</div>
</div>
<a id="a1bf906cc319e1b099f92b7c622f494fb" name="a1bf906cc319e1b099f92b7c622f494fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bf906cc319e1b099f92b7c622f494fb">&#9670;&#160;</a></span>issue_cmd_to_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int issue_cmd_to_mouse </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>cmd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>First the 0xD4 command is issued to the status port of the kbc, then command cmd is sent to the kbc output buffer, then 10 attempts are made to read the KBC's output buffer to check if the command was acknowledged(ACK) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>command to be sent </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon acknowledgement, 1 otherwise </dd></dl>

</div>
</div>
<a id="ab814784256e934abee308b68ac413719" name="ab814784256e934abee308b68ac413719"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab814784256e934abee308b68ac413719">&#9670;&#160;</a></span>kbc_restore_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kbc_restore_mouse </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disables data reporting from the mouse. </p>
<dl class="section return"><dt>Returns</dt><dd>0 upon success, 1 otherwise </dd></dl>

</div>
</div>
<a id="a210374b50462acdedab00df64d5cea3c" name="a210374b50462acdedab00df64d5cea3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a210374b50462acdedab00df64d5cea3c">&#9670;&#160;</a></span>mouse_ih()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void() mouse_ih </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads status register when an interrupt occurs and checks for timeout and parity errors, if none are found, it calls a function to read a byte to be placed in the mouse packet struct. </p>

</div>
</div>
<a id="a20285aed4b3ef45812cd967532dd09db" name="a20285aed4b3ef45812cd967532dd09db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20285aed4b3ef45812cd967532dd09db">&#9670;&#160;</a></span>mouse_subscribe_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() mouse_subscribe_int </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>bit_no</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscribes mouse interrupts using irq_reenable and irq_exclusive policy. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bit_no</td><td>hook id bit position of mouse </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 in case of success, 1 otherwise </dd></dl>

</div>
</div>
<a id="a3ecf823d80520009ae5e0d76ae40a3c3" name="a3ecf823d80520009ae5e0d76ae40a3c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ecf823d80520009ae5e0d76ae40a3c3">&#9670;&#160;</a></span>mouse_unsubscribe_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() mouse_unsubscribe_int </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubcribes mouse interrupts. </p>
<dl class="section return"><dt>Returns</dt><dd>0 upon success, 1 otherwise </dd></dl>

</div>
</div>
<a id="a7740bd988610d35f2a3c2c1c0c7fb798" name="a7740bd988610d35f2a3c2c1c0c7fb798"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7740bd988610d35f2a3c2c1c0c7fb798">&#9670;&#160;</a></span>read_byte_to_mouse_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_byte_to_mouse_packet </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Upon an interrupt this function is called, it reads a byte from the KBC and then places it in the mouse packet struct. </p>
<dl class="section return"><dt>Returns</dt><dd>0 upon success, 1 otherwise </dd></dl>

</div>
</div>
<a id="addafa059c296f73e62410c2c60e11aa4" name="addafa059c296f73e62410c2c60e11aa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addafa059c296f73e62410c2c60e11aa4">&#9670;&#160;</a></span>read_data_from_KBC_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_data_from_KBC_mouse </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the KBC's status byte to check if KBC'S output buffer is full, if so, its contents are placed in 'data' parameter and checked for errors and correspondance to mouse data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
